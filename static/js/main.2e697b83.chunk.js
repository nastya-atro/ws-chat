(this["webpackJsonpws-chat"]=this["webpackJsonpws-chat"]||[]).push([[0],{119:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(10),c=n.n(r),i=(n(93),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,167)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))}),s=n(53),o=n(9),u=n(15),l=(n(97),n(56)),h=n(73),d=n(17),j=n.n(d),b=n(24),p=n(61),f=n(25),g=null,m={"messages-recived":[],"status-changed":[]},O=function(e){m["status-changed"].forEach((function(t){return t(e)}))},x=function(){O("ready")},v=function(){O("penging"),setTimeout(C,3e3)},_=function(e){var t=JSON.parse(e.data);m["messages-recived"].forEach((function(e){return e(t)}))},w=function(){var e,t,n;null===(e=g)||void 0===e||e.removeEventListener("close",v),null===(t=g)||void 0===t||t.removeEventListener("message",_),null===(n=g)||void 0===n||n.removeEventListener("open",x)};function C(){var e;w(),null===(e=g)||void 0===e||e.close(),g=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"),O("penging"),g.addEventListener("close",v),g.addEventListener("message",_),g.addEventListener("open",x)}var N=function(){C()},E=function(){var e;m["messages-recived"]=[],m["status-changed"]=[],w(),null===(e=g)||void 0===e||e.close()},y=function(e,t){return m[e].push(t),function(){m[e]=m[e].filter((function(e){return e!==t}))}},I=function(e,t){m[e]=m[e].filter((function(e){return e!==t}))},L=function(e){var t;null===(t=g)||void 0===t||t.send(e)},S={chatMessages:[],status:"pending"},k=function(e){return{type:"chat/MESSAGES_RECIVED",newChatMessages:e}},P=function(e){return{type:"chat/STATUS_CHANGED",status:e}},A=null,T=function(e){return null===A&&(A=function(t){e(k(t))}),A},F=null,M=function(e){return null===F&&(F=function(t){e(P(t))}),F},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"chat/MESSAGES_RECIVED":return Object(f.a)(Object(f.a)({},e),{},{chatMessages:[].concat(Object(p.a)(e.chatMessages),Object(p.a)(t.newChatMessages))});case"chat/STATUS_CHANGED":return Object(f.a)(Object(f.a)({},e),{},{status:t.status});default:return e}},G=n(74),R=n.n(G).a.create({withCredentials:!0,headers:{"API-KEY":"e33a9b28-32d1-4022-81b8-0bd4ba992caa"},baseURL:"https://social-network.samuraijs.com/api/1.0/"}),B=function(e,t,n,a){return R.post("auth/login",{email:e,password:t,rememberMe:n,captcha:a}).then((function(e){return e.data}))},V=function(){return R.delete("auth/login").then((function(e){return e.data}))},H=function(){return R.get("auth/me").then((function(e){return e.data}))},U=function(){return R.get("security/get-captcha-url").then((function(e){return e.data}))},Y={id:null,email:null,login:null,isAuth:!1,captcha:null},Z=function(e,t,n,a){return{type:"login/LOGIN_RECIVED",payload:{id:e,email:t,login:n,isAuth:a}}},J=function(e){return{type:"login/CAPTCHA_RECIVED",payload:{captcha:e}}},X=function(){return function(){var e=Object(b.a)(j.a.mark((function e(t){var n,a,r,c,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:0===(n=e.sent).resultCode?(a=n.data,r=a.id,c=a.email,i=a.login,t(Z(r,c,i,!0))):console.log("error auth");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"login/CAPTCHA_RECIVED":case"login/LOGIN_RECIVED":return Object(f.a)(Object(f.a)({},e),t.payload);default:return e}},z={isInitialised:!1},W=function(){return{type:"app/INITIALISED_SUCCESS"}},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"app/INITIALISED_SUCCESS":return Object(f.a)(Object(f.a)({},e),{},{isInitialised:!0});default:return e}},$=Object(l.b)({chat:D,login:q,app:K}),Q=Object(l.c)($,Object(l.a)(h.a)),ee=function(e){return e.app.isInitialised},te=n(156),ne=n(164),ae=n(161),re=n(120),ce=n(55),ie=n(29),se=n.n(ie),oe=function(e){return e.login.login},ue=function(e){return e.login.isAuth},le=function(e){return e.login.captcha},he=n(162),de=n(154),je=n(163),be=n(155),pe=n(3),fe=function(e){var t={};return e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Required",e.password?e.password.length<6&&(t.password="Must be more then 6 characters"):t.password="Required",t},ge=function(){var e=Object(u.b)(),t=Object(u.c)(le);if(Object(u.c)(ue))return Object(pe.jsx)(o.a,{to:"/chat"});return Object(pe.jsx)("div",{children:Object(pe.jsx)(ce.c,{initialValues:{email:"",password:"",checkbox:"true",captcha:""},validate:fe,onSubmit:function(t,n){e(function(e,t,n,a){return function(){var r=Object(b.a)(j.a.mark((function r(c){var i;return j.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,B(e,t,n,a);case 2:0===(i=r.sent).resultCode?c(X()):10===i.resultCode&&c(function(){var e=Object(b.a)(j.a.mark((function e(t){var n,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:n=e.sent,a=n.url,t(J(a));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(t.email,t.password,t.checkbox,t.captcha)),n.setSubmitting(!1)},children:function(e){var n=e.values,a=e.errors,r=e.touched,c=e.handleChange,i=e.handleBlur,s=e.handleSubmit,o=e.isValid,u=e.isSubmitting;return Object(pe.jsx)(ce.b,{onSubmit:s,children:Object(pe.jsxs)("div",{className:se.a.login_form,children:[Object(pe.jsxs)("div",{children:[Object(pe.jsx)(he.a,{id:"standard-basic",label:"Login",onChange:c,onBlur:i,type:"email",name:"email",value:n.email,className:se.a.chat_textField}),Object(pe.jsxs)("div",{className:se.a.error,children:[" ",a.email&&r.email&&a.email]})]}),Object(pe.jsxs)("div",{children:[Object(pe.jsx)(he.a,{onChange:c,onBlur:i,type:"password",name:"password",placeholder:"Password",value:n.password,id:"standard-password-input",autoComplete:"current-password",className:se.a.chat_textField}),Object(pe.jsxs)("div",{className:se.a.error,children:[a.password&&r.password&&a.password," "]})]}),Object(pe.jsx)("div",{children:Object(pe.jsx)(de.a,{control:Object(pe.jsx)(je.a,{onChange:c,name:"checkbox",inputProps:{"aria-label":"primary checkbox"}}),label:"remember me"})}),t&&Object(pe.jsx)(ce.a,{onChange:c,type:"text",name:"captcha"}),Object(pe.jsxs)("div",{className:se.a.buttonLogin,children:[Object(pe.jsx)(be.a,{style:{backgroundColor:"rgba(255, 242, 128, 0.986)"},type:"submit",disabled:!o||u,variant:"contained",color:"secondary",children:"Log in "})," "]})]})})}})})},me=n(54),Oe=n(157),xe=n(46),ve=n.n(xe),_e=n(158),we=function(e){return e.chat.chatMessages},Ce=function(e){return e.chat.status},Ne=Object(te.a)((function(e){return Object(ne.a)({textField:{width:"88%",backgroundColor:"rgba(255, 242, 128, 0.356)"},button:{width:"90%",marginLeft:"8px",padding:"13px 5px",backgroundColor:"rgba(255, 242, 128, 0.986)"}})})),Ee=function(){var e=Ne(),t=Object(a.useState)(""),n=Object(me.a)(t,2),r=n[0],c=n[1],i=Object(u.b)(),s=Object(u.c)(Ce);return Object(pe.jsx)("div",{className:ve.a.chat_form,children:Object(pe.jsx)("form",{noValidate:!0,autoComplete:"off",children:Object(pe.jsxs)(Oe.a,{container:!0,alignItems:"center",children:[Object(pe.jsx)(Oe.a,{item:!0,xs:2,children:Object(pe.jsx)(be.a,{disabled:"ready"!==s,onClick:function(){var e;r&&(i((e=r,function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:L(e);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),c(""))},variant:"contained",color:"inherit",className:e.button,endIcon:Object(pe.jsx)(_e.a,{children:"send"}),children:"Send"})}),Object(pe.jsx)(Oe.a,{item:!0,xs:!0,children:Object(pe.jsx)(he.a,{className:e.textField,id:"outlined-basic",variant:"outlined",label:"Your message...",onChange:function(e){return c(e.currentTarget.value)},value:r})})]})})})},ye=n(165),Ie=Object(te.a)((function(e){return Object(ne.a)({chat_userPhoto:{width:e.spacing(7),height:e.spacing(7),marginTop:e.spacing(1)}})})),Le=function(e){var t=Ie();return Object(pe.jsxs)(Oe.a,{container:!0,direction:"row",alignItems:"center",children:[Object(pe.jsx)(Oe.a,{item:!0,xs:2,children:Object(pe.jsxs)(Oe.a,{container:!0,direction:"column",alignItems:"center",children:[Object(pe.jsx)(Oe.a,{item:!0,children:e.photo?Object(pe.jsx)(ye.a,{className:t.chat_userPhoto,alt:"userPhoto",src:e.photo}):Object(pe.jsxs)(ye.a,{className:t.chat_userPhoto,"aria-label":"recipe",children:[e.userName.charAt(0).toUpperCase()," "]})}),Object(pe.jsx)(Oe.a,{item:!0,className:ve.a.chat_userName,children:e.userName})]})}),Object(pe.jsx)(Oe.a,{item:!0,xs:!0,children:Object(pe.jsx)(Oe.a,{item:!0,xs:!0,className:ve.a.chat_userMessage,children:e.message})})]})},Se=function(){var e=Object(u.c)(we),t=Object(a.useRef)(null),n=Object(a.useState)(!0),r=Object(me.a)(n,2),c=r[0],i=r[1];Object(a.useEffect)((function(){var e;c&&(null===(e=t.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[e]);var s=e.map((function(e,t){return Object(pe.jsx)(Le,{userId:e.userId,message:e.message,photo:e.photo,userName:e.userName},t)}));return Object(pe.jsxs)("div",{style:{height:"500px",overflowY:"auto"},onScroll:function(e){var t=e.currentTarget;Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<300?!c&&i(!0):c&&i(!1)},children:[s,Object(pe.jsx)("div",{ref:t})]})},ke=Object(te.a)((function(e){return Object(ne.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},chat_container:{marginTop:e.spacing(3)},chat_appBar:{backgroundColor:"rgba(255, 242, 128, 0.986)"}})})),Pe=function(){var e=ke(),t=Object(u.b)();return Object(a.useEffect)((function(){return t(function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N(),y("messages-recived",T(t)),y("status-changed",M(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),function(){t(function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(),I("messages-recived",T(t)),I("status-changed",M(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),[]),Object(pe.jsxs)(a.Fragment,{children:[Object(pe.jsx)(re.a,{elevation:0,className:e.chat_container,children:Object(pe.jsx)(Se,{})}),Object(pe.jsx)(Ee,{})]})},Ae=n(159),Te=n(160),Fe=n(121),Me=Object(te.a)((function(e){return Object(ne.a)({title:{flexGrow:1},chat_container:{marginTop:e.spacing(3)},chat_appBar:{backgroundColor:"rgba(255, 242, 128, 0.986)"}})})),De=function(){var e=Me(),t=Object(u.c)(oe),n=Object(u.c)(ue),a=Object(u.b)();return Object(pe.jsx)(Ae.a,{className:e.chat_appBar,position:"static",children:Object(pe.jsxs)(Te.a,{children:[Object(pe.jsx)(Fe.a,{variant:"h6",className:e.title,children:"Chat online"}),n?Object(pe.jsxs)(pe.Fragment,{children:[Object(pe.jsxs)("div",{className:se.a.loginName,children:[t," "]}),Object(pe.jsx)(be.a,{onClick:function(){a(function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:0===e.sent.resultCode?t(Z(null,null,null,!1)):console.log("error auth");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},color:"inherit",children:"Log-out"})]}):Object(pe.jsxs)(s.b,{className:se.a.buttonLoginPage,to:"/login",children:[" ",Object(pe.jsx)(be.a,{color:"inherit",children:"Login"})]})]})})},Ge=Object(te.a)((function(e){return Object(ne.a)({title:{flexGrow:1},chat_container:{marginTop:e.spacing(3)},chat_paper:{minHeight:"650px"}})})),Re=Object(o.f)((function(){var e=Ge(),t=Object(u.c)(ee),n=Object(u.b)();Object(u.c)(ue);return Object(a.useEffect)((function(){n(function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(X());case 2:n=e.sent,Promise.all([n]),t(W());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),t?Object(pe.jsx)(ae.a,{className:e.chat_container,maxWidth:"md",children:Object(pe.jsxs)(re.a,{elevation:3,className:e.chat_paper,children:[Object(pe.jsx)(De,{}),Object(pe.jsx)(o.b,{exact:!0,path:"/",render:function(){return Object(pe.jsx)(o.a,{to:"/chat"})}}),Object(pe.jsx)(o.b,{path:"/chat",render:function(){return Object(pe.jsx)(Pe,{})}}),Object(pe.jsx)(o.b,{path:"/login",render:function(){return Object(pe.jsx)(ge,{})}})]})}):Object(pe.jsx)("div",{children:"Loaging..."})})),Be=function(){return Object(pe.jsx)(Re,{})},Ve=function(){return Object(pe.jsx)(s.a,{basename:"/ws-chat",children:Object(pe.jsx)(u.a,{store:Q,children:Object(pe.jsx)(Be,{})})})};c.a.render(Object(pe.jsx)(Ve,{}),document.getElementById("root")),i()},29:function(e,t,n){e.exports={login_form:"LoginPage_login_form__2zX4h",chat_textField:"LoginPage_chat_textField__2ZwFc",error:"LoginPage_error__3wOuz",buttonLogin:"LoginPage_buttonLogin___rInl",buttonLoginPage:"LoginPage_buttonLoginPage__3gEiY",loginName:"LoginPage_loginName__2jheH"}},46:function(e,t,n){e.exports={chat_paper:"Chat_chat_paper__29sB3",chat_userName:"Chat_chat_userName__X8cOp",chat_userMessage:"Chat_chat_userMessage__2GX1Y",chat_form:"Chat_chat_form__33ciF"}},93:function(e,t,n){},97:function(e,t,n){}},[[119,1,2]]]);
//# sourceMappingURL=main.2e697b83.chunk.js.map